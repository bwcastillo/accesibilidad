for (i in seq(KMZs)){
tryCatch(tmp <- getKMLcoordinates(paste0("kml/",folder,"/", KMZs[i]), ignoreAltitude = T), error = function(x){print(KMZs[i]); tmp <- NA})
if (class(tmp) == "matrix" | length(tmp) == 1) {print(KMZs[i]);next()}
tmp <- do.call(rbind, tmp)
colnames(tmp) <- c("lon", "lat")
LonLat <- rbind(LonLat, tmp)
}
library(rvest)
library(stringr)
setwd("C:/Users/usuario/Documents/Rwork/Accesibilidad")
setwd("Raw_Data")
# Definir RegiÃ³n a trabajar
region <- 8
# Hacer un scrapping de las ferias para obtener los links de las ferias
# En las comunas de la regiÃ³n
html <- read_html(paste0("http://www.asof.cl/apps/mapaferias/regiones/",region,".php"))
urls <- html %>%
html_nodes("option") %>%
html_attr("value") %>%
na.omit()
# Un sapplay que hae un scrap de las urls de los mapas de cada comuna
maps <- sapply(urls, function(x) {
read_html(paste0("http://www.asof.cl/apps/mapaferias/regiones/",x)) %>%
html_nodes("iframe") %>%
html_attr("src")
}
)
# Un sapply que extrae los ids de los archivos kml de cada comuna
ids <- sapply(maps, function(x) {
str_extract(read_html(x) %>%
html_nodes(xpath = '//meta[@itemprop="url"]') %>%
html_attr('content'), "[-_0-9A-Za-z]+$")
}
)
# Descarga los kml de cada comuna en la region
for (mid in ids) {
namess <- gsub("/", "_", names(ids[ids == mid]))
namess <- gsub(".php", "", namess)
dir.create(paste0("kml/",region))
download.file(paste0("https://www.google.com/maps/d/u/0/kml?mid=",mid,"&forcekml=1"),paste0("kml/",region,"/",namess, "_", mid,".kmz"))
}
#Hasta aqui todo bien tuve que crear la carpeta kml y creo solo la subcarpeta con el número de la región "8", luego empezó a descargar los archivos en formato kmz
# extract long-lat coordinates from a bunch of kmz files
# first unzips the KMZ-s then reads coordinates from each KML with getKMLcoordinates {maptools}
# (worth checking this as well: https://gist.github.com/holstius/6631918 )
library(maptools)
setwd("C:/Users/usuario/Documents/Rwork/Accesibilidad/Raw_Data/")
# list the kmz files in a given folder path
#Aquí debo configurar por carpeta, en vez de 8 estaba predefinido con rms, supongo que era para la RMSantiago, ahora puse 8 (la carpeta que tengo) y el objeto kmz es una lista de los kmz
KMZs <- list.files(path="kml/8/", pattern="*.kmz", full.names=FALSE)
seq(KMZs)
?tryCatch
for (i in seq(KMZs)){
tryCatch(tmp <- getKMLcoordinates(paste0("kml/",folder,"/", KMZs[i]), ignoreAltitude = T), error = function(x){print(KMZs[i]); tmp <- NA})
if (class(tmp) == "matrix" | length(tmp) == 1) {print(KMZs[i]);next()}
tmp <- do.call(rbind, tmp)
colnames(tmp) <- c("lon", "lat")
LonLat <- rbind(LonLat, tmp)
}
getKMLcoordinates(paste0("kml/",folder,"/", KMZs[i]), ignoreAltitude = T)
getKMLcoordinates(paste0("kml/",folder,"/", KMZs), ignoreAltitude = T)
getKMLcoordinates(paste0("kml/8/", KMZs), ignoreAltitude = T)
for (i in seq(KMZs)){
tryCatch(tmp <- getKMLcoordinates(paste0("kml/",folder,"/", KMZs[i]), ignoreAltitude = T), error = function(x){print(KMZs[i]); tmp <- NA})
if (class(tmp) == "matrix" | length(tmp) == 1) {print(KMZs[i]);next()}
tmp <- do.call(rbind, tmp)
colnames(tmp) <- c("lon", "lat")
LonLat <- rbind(LonLat, tmp)
}
for (i in seq(KMZs)){
tryCatch(tmp <- getKMLcoordinates(paste0("kml/",folder,"/", KMZs[i]), ignoreAltitude = T), #error = function(x){print(KMZs[i]); tmp <- NA
})
if (class(tmp) == "matrix" | length(tmp) == 1) {print(KMZs[i]);next()}
tmp <- do.call(rbind, tmp)
colnames(tmp) <- c("lon", "lat")
LonLat <- rbind(LonLat, tmp)
}
tmp <- getKMLcoordinates(paste0("kml/",folder,"/", KMZs[i]), ignoreAltitude = T)
tryCatch(tmp <- getKMLcoordinates(paste0("C:/Users/usuario/Documents/Rwork/Accesibilidad/Raw_Data/kml/8/",KMZs[i]), ignoreAltitude = T), error = function(x){print(KMZs[i]); tmp <- NA})
View(tmp)
View(tmp[[1]])
View(tmp[[2]])
for (i in seq(KMZs)){
tryCatch(tmp <- getKMLcoordinates(paste0("C:/Users/usuario/Documents/Rwork/Accesibilidad/Raw_Data/kml/8/",KMZs[i]), ignoreAltitude = T), error = function(x){print(KMZs[i]); tmp <- NA})
if (class(tmp) == "matrix" | length(tmp) == 1) {print(KMZs[i]);next()}
tmp <- do.call(rbind, tmp)
colnames(tmp) <- c("lon", "lat")
LonLat <- rbind(LonLat, tmp)
}
tryCatch(tmp <- getKMLcoordinates(paste0("C:/Users/usuario/Documents/Rwork/Accesibilidad/Raw_Data/kml/8/",KMZs[i]), ignoreAltitude = T), error = function(x){print(KMZs[i]); tmp <- NA})
for (i in seq(KMZs)){
tryCatch(tmp <- getKMLcoordinates(paste0("C:/Users/usuario/Documents/Rwork/Accesibilidad/Raw_Data/kml/8/",KMZs[i]), ignoreAltitude = T), error = function(x){print(KMZs[i]); tmp <- NA})
if (class(tmp) == "matrix" | length(tmp) == 1) {print(KMZs[i]);next()}
tmp <- do.call(rbind, tmp)
colnames(tmp) <- c("lon", "lat")
LonLat <- rbind(LonLat, tmp)
}
View(tmp)
?tempfile
getKMLcoordinates(system.file("C:/Users/usuario/Documents/Rwork/Accesibilidad/Raw_Data/kml/8/"))
zz<-getKMLcoordinates(system.file("C:/Users/usuario/Documents/Rwork/Accesibilidad/Raw_Data/kml/8/"), package="maptools"))
zz<-getKMLcoordinates(system.file("C:/Users/usuario/Documents/Rwork/Accesibilidad/Raw_Data/kml/8/", package="maptools"))
View(zz)
for (i in seq(KMZs)){
tryCatch(tmp <- getKMLcoordinates(paste0("C:/Users/usuario/Documents/Rwork/Accesibilidad/Raw_Data/kml/8/",KMZs[i]), ignoreAltitude = T), error = function(x){print(KMZs[i]); tmp <- NA})
if (class(tmp) == "matrix" | length(tmp) == 1) {print(KMZs[i]);next()}
tmp <- do.call(rbind, tmp)
colnames(tmp) <- c("lon", "lat")
LonLat <- rbind(LonLat, tmp)
}
KMZs[i]
View(KMZs)
paste0("C:/Users/usuario/Documents/Rwork/Accesibilidad/Raw_Data/kml/8/",KMZs[i]), ignoreAltitude = T)
getKMLcoordinates(paste0("C:/Users/usuario/Documents/Rwork/Accesibilidad/Raw_Data/kml/8/",KMZs[1]), ignoreAltitude = T)
getKMLcoordinates(paste0("C:/Users/usuario/Documents/Rwork/Accesibilidad/Raw_Data/kml/8/",KMZs[2]), ignoreAltitude = T)
for (i in seq(KMZs)){
getKMLcoordinates(paste0("C:/Users/usuario/Documents/Rwork/Accesibilidad/Raw_Data/kml/8/",KMZs[i]), ignoreAltitude = T)
}
View(tmp)
for (i in seq(KMZs)){
zz<- getKMLcoordinates(paste0("C:/Users/usuario/Documents/Rwork/Accesibilidad/Raw_Data/kml/8/",KMZs[i]), ignoreAltitude = T)
}
View(zz)
View(zz[1])
View(zz[[1]])
View(zz[[2]])
View(zz[[3]])
View(zz[[1]])
getKMLcoordinates(paste0("C:/Users/usuario/Documents/Rwork/Accesibilidad/Raw_Data/kml/8/",KMZs[24]), ignoreAltitude = T)
getKMLcoordinates(paste0("C:/Users/usuario/Documents/Rwork/Accesibilidad/Raw_Data/kml/8/",KMZs[1]), ignoreAltitude = T)
for (i in seq(KMZs)){
print( getKMLcoordinates(paste0("C:/Users/usuario/Documents/Rwork/Accesibilidad/Raw_Data/kml/8/",KMZs[i]), ignoreAltitude = T))
}
for (i in seq(KMZs)){
zz<- getKMLcoordinates(paste0("C:/Users/usuario/Documents/Rwork/Accesibilidad/Raw_Data/kml/8/",KMZs[i]), ignoreAltitude = T)
}
View(zz)
zz[[1]]
zz[[2]]
for (i in seq(KMZs)){
zz[[i]]<- getKMLcoordinates(paste0("C:/Users/usuario/Documents/Rwork/Accesibilidad/Raw_Data/kml/8/",KMZs[i]), ignoreAltitude = T)
}
View(zz)
for (i in seq(KMZs)){
tmp[[i]]<- getKMLcoordinates(paste0("C:/Users/usuario/Documents/Rwork/Accesibilidad/Raw_Data/kml/8/",KMZs[i]), ignoreAltitude = T)
tmp <- do.call(rbind, tmp)
}
View(tmp)
for (i in seq(KMZs)){
tmp[[i]]<- getKMLcoordinates(paste0("C:/Users/usuario/Documents/Rwork/Accesibilidad/Raw_Data/kml/8/",KMZs[i]), ignoreAltitude = T)
tmp [[i]]<- do.call(rbind, tmp)
}
for (i in seq(KMZs)){
tmp[[i]]<- getKMLcoordinates(paste0("C:/Users/usuario/Documents/Rwork/Accesibilidad/Raw_Data/kml/8/",KMZs[i]), ignoreAltitude = T)
tmp [[i]]<- do.call(rbind, tmp)
}
for (i in seq(KMZs)){
tmp[[i]]<- getKMLcoordinates(paste0("C:/Users/usuario/Documents/Rwork/Accesibilidad/Raw_Data/kml/8/",KMZs[i]), ignoreAltitude = T)
}
View(tmp)
rm(tmp)
for (i in seq(KMZs)){
tmp[[i]]<- getKMLcoordinates(paste0("C:/Users/usuario/Documents/Rwork/Accesibilidad/Raw_Data/kml/8/",KMZs[i]), ignoreAltitude = T)
}
for (i in seq(KMZs)){
tmp[[i]]<- getKMLcoordinates(paste0("C:/Users/usuario/Documents/Rwork/Accesibilidad/Raw_Data/kml/8/",KMZs[i]), ignoreAltitude = T)
}
for (i in seq(KMZs)){
zz[[i]]<- getKMLcoordinates(paste0("C:/Users/usuario/Documents/Rwork/Accesibilidad/Raw_Data/kml/8/",KMZs[i]), ignoreAltitude = T)
}
for (i in seq(KMZs)){
zz[[i]]<- getKMLcoordinates(paste0("C:/Users/usuario/Documents/Rwork/Accesibilidad/Raw_Data/kml/8/",KMZs[i]), ignoreAltitude = T)
zz[[i]] <- do.call(rbind, zz[[i]])
}
for (i in seq(KMZs)){
zz[[i]]<- getKMLcoordinates(paste0("C:/Users/usuario/Documents/Rwork/Accesibilidad/Raw_Data/kml/8/",KMZs[i]), ignoreAltitude = T)
zz[[i]] <- do.call(rbind, zz[[i]])
colnames(zz[[i]]) <- c("lon", "lat")
}
View(zz[[i]])
